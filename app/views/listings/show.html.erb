
<p>
  <b>Employer:</b>
  <%=h link_to @listing.user.login, @listing.user %>
</p>

<p>
  <b>Title:</b>
  <%=h @listing.title %>
</p>

<p>
  <b>Category:</b>
  <%=h @listing.category %>
</p>

<p>
  <b>Address: </b>
  <%=h @listing.address %>
</p>

<p>
  <b>Description:</b>
  <%=h @listing.description %>
</p>

<p>
  <b>Approx payment:</b>
  $<%=h @listing.approx_payment %>
</p>

<!---
<%= link_to 'Edit', edit_listing_path(@listing) %> |
<%= link_to 'Back', listings_path %> -->

<% if current_user and current_user.id!=@listing.user.id %>
<!--- Logged on User is not the Listing Owner --->
	<% if @past_offer != nil %>
		<% form_for(@past_offer, :html=>{:class=>'service_offer'}) do |f| %>
		<%= f.error_messages %>
		<% if @listing.active==false and @past_offer.accepted==true %>
			<span class='past_offer'> Your offer to work for $<%=h @past_offer.amount %> has been accepted. Contact the employer below for further details.<br>
			<%= form_tag :controller => 'listings', :action => 'add_erating', :id=>'add_erating' %>asdf
			<script>
				new Starry('add_erating', {name:"rating"});
			</script>
			</form></span>
		<% elsif @listing.active==false and @past_offer.accepted==false %>
			<span class='past_offer'> Sorry, your offer to work for $<%=h @past_offer.amount %> has not been accepted. However, you might get a second chance. </span>
		<% else %>
			<span class='past_offer, past_offer_active'> You have made an offer to work for $<%=h @past_offer.amount %> </span>
			Change this amount? $ <%= f.text_field :amount, :size=>3 %>
			<%= f.hidden_field :user_id, :value=>current_user.id %>
			<%= f.hidden_field :listing_id, :value=>@listing.id %>
			<%= f.submit 'Change' %>
		<% end %>
		<% end %>
	<% else %>
		<% form_for(@offer, :html=>{:class=>'service_offer'}) do |f| %>
		<%= f.error_messages %>
		<b> Offer to Work: </b> 
		Service Charge $ <%= f.text_field :amount, :size=>3 %>
		<%= f.hidden_field :user_id, :value=>current_user.id %>
		<%= f.hidden_field :listing_id, :value=>@listing.id %>
		<%= f.submit 'Submit' %>
		<% end %>
	<% end %>
	<!--- Messaging
	<div class='message messaging_title'> Messaging </div>  --->
	<% @messages.each do |message| %>
		<% if message.sender.id == current_user.id %>
			<div class='message my_message'>
		<% else %>
			<div class='message their_message'>
		<% end %>
		<%=h link_to message.sender.login, message.sender %> <%=h message.content %>
		</div>
	<% end %>
	<% if @listing.active==true or (@listing.active==false and @past_offer!=nil and @past_offer.accepted==true) %>
	<% form_for(@new_message, :html=>{:class=>'new_message message'}) do |f| %>
		<%= f.text_area :content, :size=>"65x2", :placeholder=>'Send a Message' %>
		<%= f.hidden_field :from, :value=>current_user.id %>
		<%= f.hidden_field :to, :value=>@listing.user.id %>
		<%= f.hidden_field :listing_id, :value=>@listing.id %>
		<%= f.submit 'Send' %>
	<% end %>
	<% end %>
	
	<% if @listing.active==false and current_user and @past_offer != nil and @past_offer.accepted == true %>
	
	<img src="http://maps.google.com/maps/api/staticmap?center=<%=h @place[:lat] %>,<%=h @place[:lng] %>&zoom=12&size=400x400&sensor=false">
	
	
	
	
	<% end %>
	
	
<% elsif current_user and current_user.id==@listing.user.id%>
<!--- Logged on User is the Listing Owner 
      Show each User offering to work, their ratings, and offer, and messaging between you and user ---><br>
	
	<span style="font-weight:bold; color:#4A777A; padding:5px;">The following users have offered to work:</span>
	<% @offers.each do |offer| %>
	<div class='service_offer'>
		<%=h link_to offer.user.login, offer.user %>
		<div class="rating_bar"> <div style="width:<%=h offer.user.worker_rating*20 %>%"></div></div>
		Payment: $<%=h offer.amount %>
		<div class='offer_nav'> 
		<%= link_to_function "Hide/Show Messaging", "$('messaging_for_offer#{offer.id}').toggle()" %>
		<% if @listing.active==true %>
			 | <span style='display:inline-block;'>
			<%= button_to "Accept Offer", {:action => "acceptOffer", :listing_id => @listing.id, :offer_id => offer.id }, :confirm => "Are you sure?", :method => :acceptOffer %>
			</span>
		<% elsif @listing.active==false and offer.accepted==true %>
			| <span style='display:inline-block;'>
			<%= button_to "Rescind Offer", {:action => "rescindOffer", :listing_id => @listing.id, :offer_id => offer.id }, :confirm => "Are you sure?", :method => :rescindOffer %>
			</span>
		<% elsif @listing.active==false and offer.accepted==false %>
			| <span style='display:inline-block;'>
			<%= button_to "Accept Offer", {:action => "rescindOffer", :listing_id => @listing.id, :offer_id => offer.id }, :confirm => "Are you sure?", :method => :rescindOffer, :disabled => true, :class=>'offerButton' %> </span>		
		<% end %>
		</div>	
		
	</div>
	<!--- Messages --->
	<span id='messaging_for_offer<%=h offer.id %>' style="display:none;">
		<% @messageblocks[offer.id].each do |message| %>
			<% if message.sender.id == current_user.id %>
				<div class='message my_message'>
			<% else %>
				<div class='message their_message'>
			<% end %>
			<%=h link_to message.sender.login, message.sender %> <%=h message.content %>
			</div>
		<% end %>
		<% form_for(@new_message, :html=>{:class=>'new_message message'}) do |f| %>
			<%= f.text_area :content, :size=>"65x2", :placeholder=>'Send a Message' %>
			<%= f.hidden_field :from, :value=>current_user.id %>
			<%= f.hidden_field :to, :value=>offer.user.id %>
			<%= f.hidden_field :listing_id, :value=>@listing.id %>
			<%= f.submit 'Send' %>
		<% end %>
	</span>
	<% end %>
	
	
	
<% end %>

